<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Smart Life Multi-Language Chat</title>

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,"Segoe UI","Cairo",sans-serif;
  background:#0b1220;
  color:#fff;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  transition:.3s ease;
}
header{
  padding:20px;
  border-bottom:1px solid rgba(255,255,255,.1);
  display:flex;
  align-items:center;
}
html[dir="rtl"] header{ flex-direction:row; justify-content:space-between; }
html[dir="ltr"] header{ flex-direction:row-reverse; justify-content:space-between; }

main{
  flex:1;
  display:flex;
  flex-direction:column;
  justify-content:center;
  padding:40px;
}
html[dir="rtl"] main{ text-align:right; }
html[dir="ltr"] main{ text-align:left; }

.dir-toggle{
  padding:8px 14px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.2);
  background:rgba(255,255,255,.08);
  color:#fff;
  cursor:pointer;
  font-weight:600;
}
</style>

<script>
/** ===== Ø²Ø§Ø¦Ø± Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø«Ø§Ø¨Øª 100% ===== */
function getOrCreateStableVisitor() {
  const key = "sl_stable_visitor";
  const saved = localStorage.getItem(key);
  if (saved) return JSON.parse(saved);

  const id = (crypto?.randomUUID?.() || ("sl_" + Date.now() + "_" + Math.random().toString(16).slice(2)));
  const short = id.slice(-6).toLowerCase();

  const v = {
    id,
    email: `visitor.${short}@smartlife.local`,
  };

  localStorage.setItem(key, JSON.stringify(v));
  return v;
}

function getLang(){
  return localStorage.getItem("site_lang") || "ar";
}

function buildProfile(){
  const v = getOrCreateStableVisitor();
  const lang = getLang();
  const short = v.id.slice(-6).toUpperCase();

  return {
    email: v.email,
    displayName: lang === "ar" ? `Ø²Ø§Ø¦Ø± Ø³Ù…Ø§Ø±Øª Ù„Ø§ÙŠÙ #${short}` : `SmartLife Visitor #${short}`,
    language: lang,
    subscribedAppInbox: true,
    visitorId: v.id
  };
}

/**
 * âœ… Ø£Ù‡Ù… Ø¬Ø²Ø¡: Ù†Ù†ÙÙ‘Ø° identify/attributes Ø£Ø«Ù†Ø§Ø¡ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù€ SDK
 * Ù‡Ø°Ø§ ÙŠØ³Ø§Ø¹Ø¯ Ø£Ù† Ø§Ù„Ù€ Widget ÙŠØ¨Ø¯Ø£ ÙˆÙ‡Ùˆ Ø£ØµÙ„Ø§Ù‹ â€œØ¹Ø§Ø±Ùâ€ Ø§Ù„Ø²Ø§Ø¦Ø±.
 */
window.birdAsyncInit = async function (sdk, conf) {
  // Ø§Ù„Ø¯ÙˆÙƒ ØªÙ‚ÙˆÙ„ init ÙŠØªÙ… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ØŒ Ù„ÙƒÙ† birdAsyncInit ÙŠØ³Ù…Ø­ Ø¨ØªØ®ØµÙŠØµ/init Ù…Ø¨ÙƒØ± :contentReference[oaicite:3]{index=3}
  await sdk.init({ config: conf });

  const p = buildProfile();

  // identify + (contactAttributes ÙƒÙ€ parameter Ø«Ø§Ù†ÙŠ) :contentReference[oaicite:4]{index=4}
  await sdk.contact.identify(
    {
      strategy: "Visitor",
      identifier: { key: "emailaddress", value: p.email }
    },
    {
      displayName: p.displayName,
      language: p.language,
      subscribedAppInbox: p.subscribedAppInbox,
      visitorId: p.visitorId
    }
  );

  // ØªØ¹Ø²ÙŠØ²: updateCurrent (Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù€ IdentityManager) :contentReference[oaicite:5]{index=5}
  await sdk.contact.updateCurrent({
    displayName: p.displayName,
    language: p.language,
    subscribedAppInbox: p.subscribedAppInbox,
    visitorId: p.visitorId
  });

  // (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ù„Ùˆ ØªØ­Ø¨ ØªØ³ØªØ®Ø¯Ù… putAttributes ÙƒÙ…Ø§ ÙÙŠ App Inbox docs :contentReference[oaicite:6]{index=6}
  if (sdk.contact.putAttributes) {
    await sdk.contact.putAttributes({
      displayName: p.displayName,
      subscribedAppInbox: p.subscribedAppInbox,
      language: p.language,
      visitorId: p.visitorId
    });
  }

  console.log("[Bird] Identified before widget:", p.email, p.displayName);
};
</script>
</head>

<body>

<header>
  <h2 id="title">Ø³Ù…Ø§Ø±Øª Ù„Ø§ÙŠÙ</h2>
  <button id="dirToggleBtn" class="dir-toggle">ğŸŒ English</button>
</header>

<main>
  <h1 id="headline">Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ğŸ‘‹</h1>
  <p id="desc">Ø§Ù„Ø¢Ù† Ø³ÙŠØªÙ… ØªØºÙŠÙŠØ± ØªÙ…ÙˆØ¶Ø¹ Ø§Ù„Ø´Ø§Øª Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©.</p>
</main>

<!-- âœ… SDK Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· -->
<script
  async
  src="https://embeddables.p.mbirdcdn.net/sdk/v0/bird-sdk.js"
  data-config-url="PUT_WIDGET_CONFIG_URL_HERE"
></script>

<script>
/* ======== ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ (Ø¨Ø¯ÙˆÙ† Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ SDK) ======== */
const toggleBtn = document.getElementById("dirToggleBtn");
const html = document.documentElement;

function updateDirection(dir){
  const lang = dir === "rtl" ? "ar" : "en";
  html.setAttribute("dir", dir);
  html.setAttribute("lang", lang);

  if(lang === "ar"){
    toggleBtn.textContent = "ğŸŒ English";
    document.getElementById("headline").textContent = "Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ğŸ‘‹";
    document.getElementById("desc").textContent = "Ø§Ù„Ø¢Ù† Ø³ÙŠØªÙ… ØªØºÙŠÙŠØ± ØªÙ…ÙˆØ¶Ø¹ Ø§Ù„Ø´Ø§Øª Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©.";
  } else {
    toggleBtn.textContent = "ğŸŒ Ø¹Ø±Ø¨ÙŠ";
    document.getElementById("headline").textContent = "Welcome ğŸ‘‹";
    document.getElementById("desc").textContent = "Chat position now changes correctly.";
  }

  localStorage.setItem("site_lang", lang);

  // (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ø­Ø¯Ù‘Ø« Ø§Ù„Ø§Ø³Ù…/Ø§Ù„Ù„ØºØ© Ù„Ù„Ù€ contact Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¨Ø¹Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©
  if (window.Bird?.contact?.updateCurrent) {
    const p = buildProfile();
    Bird.contact.updateCurrent({ displayName: p.displayName, language: p.language });
  }
}

const savedLang = localStorage.getItem("site_lang") || "ar";
updateDirection(savedLang === "ar" ? "rtl" : "ltr");

toggleBtn.addEventListener("click", ()=>{
  const currentDir = html.getAttribute("dir");
  updateDirection(currentDir === "rtl" ? "ltr" : "rtl");
});
</script>

</body>
</html>
