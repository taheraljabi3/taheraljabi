<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Smart Life Multi-Language Chat</title>

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,"Segoe UI","Cairo",sans-serif;
  background:#0b1220;
  color:#fff;
  min-height:100vh;
  display:flex;
  flex-direction:column;
}
header{
  padding:20px;
  border-bottom:1px solid rgba(255,255,255,.1);
  display:flex;
  justify-content:space-between;
  align-items:center;
}
main{
  flex:1;
  display:flex;
  flex-direction:column;
  justify-content:center;
  padding:40px;
}
.dir-toggle{
  padding:8px 14px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.2);
  background:rgba(255,255,255,.08);
  color:#fff;
  cursor:pointer;
  font-weight:600;
}
</style>

<script>
/* ========= ØªÙˆÙ„ÙŠØ¯ Ø±Ù‚Ù… Ø«Ø§Ø¨Øª Ù„ÙƒÙ„ Ø¬Ù‡Ø§Ø² ========= */
function getOrCreateErpId(){
  const key = "sl_erp_identity";
  let id = localStorage.getItem(key);

  if(!id){
    // Ø±Ù‚Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù…Ù† 01 Ø¥Ù„Ù‰ 99
    const num = Math.floor(Math.random()*99 + 1).toString().padStart(2,"0");
    id = "ERP-mawared-" + num;
    localStorage.setItem(key,id);
  }

  return id;
}

function buildProfile(){
  const erpId = getOrCreateErpId();
  const email = erpId + "@smartlife.local";

  return {
    erpId,
    email,
    displayName: erpId,
    subscribedAppInbox: true
  };
}

/* ========= Identify Ù‚Ø¨Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙˆØ¯Ø¬Øª ========= */
window.birdAsyncInit = async function (sdk, conf) {

  await sdk.init({ config: conf });

  const p = buildProfile();

  await sdk.contact.identify(
    {
      strategy: "Visitor",
      identifier: { key: "emailaddress", value: p.email }
    },
    {
      displayName: p.displayName,
      subscribedAppInbox: p.subscribedAppInbox
    }
  );

  if (sdk.contact.updateCurrent) {
    await sdk.contact.updateCurrent({
      displayName: p.displayName,
      subscribedAppInbox: p.subscribedAppInbox
    });
  }

  console.log("Bird Identified as:", p.displayName);
};
</script>

</head>

<body>

<header>
  <h2>Ø³Ù…Ø§Ø±Øª Ù„Ø§ÙŠÙ</h2>
  <button id="dirToggleBtn" class="dir-toggle">ğŸŒ English</button>
</header>

<main>
  <h1>Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ğŸ‘‹</h1>
  <p>Ø§Ù„Ø¢Ù† Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¸Ø§Ù‡Ø± ÙÙŠ Ø§Ù„Ø´Ø§Øª Ù‡Ùˆ ERP-mawared-XX</p>
</main>

<!-- ØªØ­Ù…ÙŠÙ„ SDK Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· -->
<script
  async
  src="https://embeddables.p.mbirdcdn.net/sdk/v0/bird-sdk.js"
  data-config-url="https://api.bird.com/workspaces/a00e85cb-1438-4c76-b1c7-a7e4f2ec3768/applications/7d702097-cc09-4d08-a20b-da3cbe9a1b61/signature/2024-06-17T17-12-51_796d7d7c62"
></script>

<script>
const toggleBtn = document.getElementById("dirToggleBtn");
const html = document.documentElement;

function updateDirection(dir){
  html.setAttribute("dir", dir);
  toggleBtn.textContent = dir === "rtl" ? "ğŸŒ English" : "ğŸŒ Ø¹Ø±Ø¨ÙŠ";
  localStorage.setItem("site_lang", dir === "rtl" ? "ar" : "en");
}

const savedLang = localStorage.getItem("site_lang") || "ar";
updateDirection(savedLang === "ar" ? "rtl" : "ltr");

toggleBtn.addEventListener("click", ()=>{
  const currentDir = html.getAttribute("dir");
  updateDirection(currentDir === "rtl" ? "ltr" : "rtl");
});
</script>

</body>
</html>

